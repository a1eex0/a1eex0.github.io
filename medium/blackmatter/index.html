<!DOCTYPE html>
<html lang="zh-cn">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">
<meta itemprop="name" content="BlackMatter">
<meta itemprop="description" content="BlackMatter 勒索软件分析 1. 前言 一个新的勒索软件团伙BlackMatter于 2021 年 7 月在地下论坛/Exploit/和/XSS/上招募附属机构。他们填补了在"><meta itemprop="datePublished" content="2021-10-18T16:13:48+08:00" />
<meta itemprop="dateModified" content="2021-10-18T16:13:48+08:00" />
<meta itemprop="wordCount" content="6230"><meta itemprop="image" content="https://www.a1ee.cn/bg.png">
<meta itemprop="keywords" content="BlackMatter,Sample," /><meta property="og:title" content="BlackMatter" />
<meta property="og:description" content="BlackMatter 勒索软件分析 1. 前言 一个新的勒索软件团伙BlackMatter于 2021 年 7 月在地下论坛/Exploit/和/XSS/上招募附属机构。他们填补了在" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.a1ee.cn/medium/blackmatter/" /><meta property="og:image" content="https://www.a1ee.cn/bg.png" /><meta property="article:section" content="medium" />
<meta property="article:published_time" content="2021-10-18T16:13:48+08:00" />
<meta property="article:modified_time" content="2021-10-18T16:13:48+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.a1ee.cn/bg.png"/>

<meta name="twitter:title" content="BlackMatter"/>
<meta name="twitter:description" content="BlackMatter 勒索软件分析 1. 前言 一个新的勒索软件团伙BlackMatter于 2021 年 7 月在地下论坛/Exploit/和/XSS/上招募附属机构。他们填补了在"/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>BlackMatter</title>
	<link rel="stylesheet" href="https://www.a1ee.cn/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css" integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin="anonymous">
	<style>.bg-img {background-image: url('https://www.a1ee.cn/bg.png');}</style>
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://www.a1ee.cn">alee</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					
				<a href="https://www.a1ee.cn/basic/">BASIC</a>
				<a href="https://www.a1ee.cn/simple/">SIMPLE</a>
				<a href="https://www.a1ee.cn/medium/">MEDIUM</a>
				<a href="https://www.a1ee.cn/about-me/">ABOUT</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="img-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg></button><span class="hdr-social hide-in-mobile"><a href="https://github.com/a1eex0" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span><button id="menu-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://www.a1ee.cn/basic/">BASIC</a></li>
			<li><a href="https://www.a1ee.cn/simple/">SIMPLE</a></li>
			<li><a href="https://www.a1ee.cn/medium/">MEDIUM</a></li>
			<li><a href="https://www.a1ee.cn/about-me/">ABOUT</a></li>
		</ul>
	</div>


	<div class="bg-img"></div>
	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Oct 18, 2021</span></div>
				<h1>BlackMatter</h1>
			</header>
			<div class="content">
				<h1 id="blackmatter-勒索软件分析">BlackMatter 勒索软件分析<a href="#blackmatter-勒索软件分析" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<h2 id="1-前言">1. 前言<a href="#1-前言" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>一个新的勒索软件团伙<code>BlackMatter</code>于 2021 年 7 月在地下论坛<code>/Exploit/</code>和<code>/XSS/</code>上招募附属机构。他们填补了在 Colonial Pipeline 攻击后<code>DarkSide</code>关闭以及<code>REvil</code>在 7 月中旬击败 Kaseya 后消失所留下的空白。该团伙表示：他们既不是<code>DarkSide</code>也不是<code>REvil</code>的继任者。宣称<code>BlackMatter</code>是将勒索软件<code>LockBit</code>、<code>REvil</code>和<code>DarkSide</code>各自的优势结合起来的最好的勒索软件。</p>
<p><strong>IOC</strong></p>
<blockquote>
<p>SHA256 : 22d7d67c3af10b1a37f277ebabe2d1eb4fd25afbd6437d4377400e148bcc08d6</p>
</blockquote>
<p>你可以在<a href="https://bazaar.abuse.ch/sample/22d7d67c3af10b1a37f277ebabe2d1eb4fd25afbd6437d4377400e148bcc08d6/">MalwareBazaar</a>下载。</p>
<p><strong>赎金票据</strong></p>
<p>勒索信的内容在<code>BlackMatter</code>的配置中进行了加密，并动态解密写入到每个目录的勒索信文件中。赎金票据文件名的形式为：<code>**.README.txt</code></p>
<p><img src="/blackmatter_images/2892754090964.png" alt=""></p>
<h2 id="2-动态解析api">2. 动态解析API<a href="#2-动态解析api" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>因为结合了诸多勒索软件的优点，那么动态解析API和基本的字符串加密是必不可少的，接下来就让我们来看看它到底是怎么做的。</p>
<p>IDA打开样本，首先便是动态解析API，函数如下：</p>
<p><img src="/blackmatter_images/2754708160965.png" alt=""></p>
<h3 id="21-哈希计算">2.1. 哈希计算<a href="#21-哈希计算" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>实际调用是使用<code>Get_Func_Addr_By_ROR13_Hash</code>导入API函数的hash进行函数加载。<code>Get_Func_Addr_By_ROR13_Hash</code>函数中可以看到首先确保<code>LoadLibraryA</code>和<code>GetProcAddress</code>已加载，然后再进行hash比对：</p>
<p><img src="/blackmatter_images/1080120167258.png" alt=""></p>
<p><code>hash</code>计算采用了循环右移<code>0xD</code>位的方式，<code>Get_Dll_Name_Hash</code>函数内容如下：</p>
<p><img src="/blackmatter_images/1502623187424.png" alt=""></p>
<p>采用<code>python</code>代码重写就美观了许多：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">Calc_Dll_Hash</span><span class="p">(</span><span class="n">dll_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">mask</span> <span class="o">=</span> <span class="mh">0xFFFFFFFF</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">dll_name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">each</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">each</span> <span class="o">&gt;</span> <span class="mh">0x40</span> <span class="ow">and</span> <span class="n">each</span> <span class="o">&lt;</span> <span class="mh">0x5b</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">each</span> <span class="o">=</span> <span class="n">each</span> <span class="o">|</span> <span class="mh">0x20</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span> <span class="o">&gt;&gt;</span> <span class="mh">0xd</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="mh">0x13</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span><span class="o">+</span><span class="n">each</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span>
</span></span></code></pre></div><p><code>Get_Func_Name_Hash</code>函数略有不同，但大同小异：</p>
<p><img src="/blackmatter_images/1134525180093.png" alt=""></p>
<p><code>python</code>代码如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">Calc_Func_Hash</span><span class="p">(</span><span class="n">dll_name</span><span class="p">,</span> <span class="n">func_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">mask</span> <span class="o">=</span> <span class="mh">0xFFFFFFFF</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">dll_name</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">func_name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">each</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span> <span class="o">&gt;&gt;</span> <span class="mh">0xd</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="mh">0x13</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span><span class="o">+</span><span class="n">each</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span>
</span></span></code></pre></div><p><strong>检验代码的有效性</strong></p>
<p>实际上要调用的函数散列可以如下这般进行计算：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">dll_name</span> <span class="o">=</span> <span class="s2">&#34;kernel32.dll&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">func_name</span> <span class="o">=</span> <span class="s2">&#34;LoadLibraryA&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">Calc_Func_Hash</span><span class="p">(</span><span class="n">Calc_Dll_Hash</span><span class="p">(</span><span class="n">dll_name</span><span class="p">),</span> <span class="n">func_name</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dll_name</span> <span class="o">=</span> <span class="s2">&#34;kernel32.dll&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">func_name</span> <span class="o">=</span> <span class="s2">&#34;GetProcAddress&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">Calc_Func_Hash</span><span class="p">(</span><span class="n">Calc_Dll_Hash</span><span class="p">(</span><span class="n">dll_name</span><span class="p">),</span> <span class="n">func_name</span><span class="p">)))</span>
</span></span></code></pre></div><p>返回结果如下：</p>
<pre tabindex="0"><code>0x27d05eb2
0xbb93705c
</code></pre><p>实际上加载<code>LoadLibraryA</code>和<code>GetProcAddress</code>的<code>hash</code>确实如此：</p>
<p><img src="/blackmatter_images/3960033176648.png" alt=""></p>
<h3 id="22-加载函数">2.2. 加载函数<a href="#22-加载函数" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>深入到<code>Resolve_API_Hash</code>函数中去，可以发现其逻辑传入两个地址，第一个地址是加载后函数存放地址，第二个地址是待解密加载的<code>hash</code>，解密密钥也很清晰：<code>0x22065FED</code>，当获取到的地址是<code>0xCCCCCCCC</code>时退出加载循环。</p>
<p><img src="/blackmatter_images/4902326117262.png" alt=""></p>
<p>加载函数前有两个<code>push</code>，通过动态调试可以知道第一个<code>push</code>是加载函数存放起始地址，第二个<code>push</code>是需要解密的函数<code>hash</code>存放起始地址。简单调试后可以得到知道每个<code>dll</code>加载时的<code>hash</code></p>
<p><img src="/blackmatter_images/3452450090969.png" alt=""></p>
<p>可以检索一下所有的本地dll文件，计算hash进行比对，</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&#34;C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">System32&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s1">&#39;.dll&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">dll_hash</span> <span class="o">=</span> <span class="n">Calc_Dll_Hash</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">dll_name</span> <span class="o">=</span> <span class="n">filename</span>
</span></span><span class="line"><span class="cl">        <span class="nb">dict</span><span class="p">[</span><span class="nb">hex</span><span class="p">(</span><span class="n">dll_hash</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;411677B7:&#39;</span><span class="o">+</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;0X411677B7&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B1FC7F66:&#39;</span><span class="o">+</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;0XB1FC7F66&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BCFA1667:&#39;</span><span class="o">+</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;0XBCFA1667&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;7132A177:&#39;</span><span class="o">+</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;0X7132A177&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;3032403A:&#39;</span><span class="o">+</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;0X3032403A&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;391830B4:&#39;</span><span class="o">+</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;0X391830B4&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;38327FBA:&#39;</span><span class="o">+</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;0X38327FBA&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;C50C676F:&#39;</span><span class="o">+</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;0XC50C676F&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;820A18A3:&#39;</span><span class="o">+</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;0X820A18A3&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;FD1A17C6:&#39;</span><span class="o">+</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;0XFD1A17C6&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;41E8A017:&#39;</span><span class="o">+</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;0X41E8A017&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;3CFC1737:&#39;</span><span class="o">+</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;0X3CFC1737&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;C3BC5607:&#39;</span><span class="o">+</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;0XC3BC5607&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;76E87915:&#39;</span><span class="o">+</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;0X76E87915&#39;</span><span class="p">])</span>
</span></span></code></pre></div><p>最终计算结果如下：</p>
<pre tabindex="0"><code>411677B7:ntdll.dll
B1FC7F66:kernel32.dll
BCFA1667:advapi32.dll
7132A177:user32.dll
3032403A:gdi32.dll
391830B4:shell32.dll
38327FBA:ole32.dll
C50C676F:shlwapi.dll
820A18A3:oleaut32.dll
FD1A17C6:wtsapi32.dll
41E8A017:RstrtMgr.dll
3CFC1737:netapi32.dll
C3BC5607:activeds.dll
76E87915:wininet.dll
</code></pre><p>查看第二个参数地址可以找到需要进行加载的<code>hash</code>再未进行异或前的<code>hash</code>。
<img src="/blackmatter_images/4401659177428.png" alt=""></p>
<h3 id="23-idapython解密">2.3. IDAPython解密<a href="#23-idapython解密" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>根据上面的结论，可以进行简单的逻辑实现：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 传入Resolve_API_Hash函数的的地址</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">Resolve_All_APIs</span><span class="p">(</span><span class="n">resolve_ea</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 获取dll加载函数的交叉引用地址</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">idautils</span><span class="o">.</span><span class="n">CodeRefsTo</span><span class="p">(</span><span class="n">resolve_ea</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_ea</span> <span class="o">=</span> <span class="n">ref</span>
</span></span><span class="line"><span class="cl">        <span class="n">api_addr_ea</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="n">api_hashes_ea</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 获取上一条汇编语言的地址</span>
</span></span><span class="line"><span class="cl">            <span class="n">prev_instruction_ea</span> <span class="o">=</span> <span class="n">idc</span><span class="o">.</span><span class="n">prev_head</span><span class="p">(</span><span class="n">current_ea</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 判断助记符是否为push</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">idc</span><span class="o">.</span><span class="n">print_insn_mnem</span><span class="p">(</span><span class="n">prev_instruction_ea</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;push&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">api_addr_ea</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># 向上第一条push是api写入地址</span>
</span></span><span class="line"><span class="cl">                    <span class="n">api_addr_ea</span> <span class="o">=</span> <span class="n">idc</span><span class="o">.</span><span class="n">get_operand_value</span><span class="p">(</span><span class="n">prev_instruction_ea</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># 再向上一条push是apihash存储的地址</span>
</span></span><span class="line"><span class="cl">                    <span class="n">api_hashes_ea</span> <span class="o">=</span> <span class="n">idc</span><span class="o">.</span><span class="n">get_operand_value</span><span class="p">(</span><span class="n">prev_instruction_ea</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span>
</span></span><span class="line"><span class="cl">            <span class="n">current_ea</span> <span class="o">=</span> <span class="n">prev_instruction_ea</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">api_addr_ea</span> <span class="o">+=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">        <span class="n">api_hashes_ea</span> <span class="o">+=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 根据地址获取hash</span>
</span></span><span class="line"><span class="cl">            <span class="n">api_hash</span> <span class="o">=</span> <span class="n">idc</span><span class="o">.</span><span class="n">get_wide_dword</span><span class="p">(</span><span class="n">api_hashes_ea</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">index</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">api_hash</span> <span class="o">==</span> <span class="mh">0xCCCCCCCC</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 进行异或解密</span>
</span></span><span class="line"><span class="cl">            <span class="n">api_hash</span> <span class="o">=</span> <span class="n">api_hash</span> <span class="o">^</span> <span class="mh">0x22065FED</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">api_hash</span> <span class="ow">in</span> <span class="n">export_hashes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="n">export_hashes</span><span class="p">[</span><span class="n">api_hash</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># 写入地址对应的api函数名</span>
</span></span><span class="line"><span class="cl">                <span class="n">idc</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">api_addr_ea</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;mw_&#39;</span> <span class="o">+</span> <span class="n">export_hashes</span><span class="p">[</span><span class="n">api_hash</span><span class="p">],</span> <span class="n">idaapi</span><span class="o">.</span><span class="n">SN_CHECK</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">api_addr_ea</span><span class="p">),</span><span class="s1">&#39;NOTFOUND&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span></code></pre></div><h2 id="3-bypassuac">3. BypassUAC<a href="#3-bypassuac" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>当成功加载<code>dll</code>后，开始检查当前用户的<code>RID</code>是否是<code>administrators</code>:</p>
<p><img src="/blackmatter_images/944715141047.png" alt=""></p>
<p>接着通过对比<code>OSMajorVersion</code>与<code>OSMinorVersion</code>检查操作系统版本：</p>
<p><img src="/blackmatter_images/5467628159473.png" alt=""></p>
<p>从<code>TOKEN_GROUPS</code>中判断进程令牌是否是<code>admin</code>权限。</p>
<p><img src="/blackmatter_images/200218177506.png" alt=""></p>
<p>如果不是<code>admin</code>权限运行，则进行提权，使用<code>LdrEnumerateLoadedModules</code>将<code>C:\\Windows\\System32\\dllhost.exe</code>注入到进程的<code>PEB</code>中，这样可以使用<code>dllhost.exe</code>接管<code>COM</code>对象。</p>
<p><img src="/blackmatter_images/3381612236730.png" alt=""></p>
<p>调用<code>CoGetObject</code>创建以下对象：</p>
<pre tabindex="0"><code>Elevation:Administrator!new:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}
</code></pre><p>通过<code>COM</code>库重载自身，从而达到权限提升的目的，整个<code>BypassUAC</code>过程如下：</p>
<p><img src="/blackmatter_images/5558435232484.png" alt=""></p>
<p>最后再调用<code>NtTerminateProcess</code>终止自身。</p>
<h2 id="4-勒索设备id号生成">4. 勒索设备ID号生成<a href="#4-勒索设备id号生成" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>获取注册表项<code>SOFTWARE\Microsoft\Cryptography</code>中的<code>MachineGuid</code>，经过三次<code>ror13</code>，再进行字节反转，最后<code>base64</code>编码一次，再将<code>+</code>、<code>/</code>、<code>=</code>符号进行转义，生成勒索设备ID号。</p>
<p><img src="/blackmatter_images/803600179474.png" alt=""></p>
<p>解密出勒索信文件名<code>%s.README.txt</code>：</p>
<p><img src="/blackmatter_images/2694503167341.png" alt=""></p>
<h2 id="5-窃取登录凭证">5. 窃取登录凭证<a href="#5-窃取登录凭证" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>接着会尝试使用<code>LogonUserW</code>窃取登录凭证：</p>
<p><img src="/blackmatter_images/843407190176.png" alt=""></p>
<p>然后检查该用户是否属于<code>DOMAINNAME\Domain Admins</code>：</p>
<p><img src="/blackmatter_images/1674812186731.png" alt=""></p>
<h2 id="6-勒索主体">6. 勒索主体<a href="#6-勒索主体" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>该功能模块主要是根据不同的命令参数进行功能分化，不同的参数执行不同的功能：</p>
<p><img src="/blackmatter_images/4842829189475.png" alt=""></p>
<h3 id="61-命令参数解析">6.1. 命令参数解析<a href="#61-命令参数解析" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>可以看到<code>BlackMatter</code>支持以下四个命令参数：</p>
<pre tabindex="0"><code>-path &lt;pwd&gt;      加密&lt;pwd&gt;路径的文件
&lt;pwd&gt;            加密&lt;pwd&gt;路径的文件
-safe            安全模式重启
-wall            设置壁纸
</code></pre><p>由于存储在样本中的是<code>hash</code>，所以只能通过生成明文字典（very luncky），再计算出字符串的<code>hash</code>进行比对，最终确认出明文命令：</p>
<p><img src="/blackmatter_images/5609927141049.png" alt=""></p>
<h3 id="62-指定路径模式">6.2. 指定路径模式<a href="#62-指定路径模式" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>当使用<code>-path &lt;pwd&gt;</code>或<code>&lt;pwd&gt;</code>参数时，将创建<code>I/O</code>接口进行加密，然后再重写生成加密文件。</p>
<p>当<code>-path &lt;pwd&gt;</code>中的<code>&lt;pwd&gt;</code>是服务器路径时，将检索共享资源进行加密：</p>
<p><img src="/blackmatter_images/2045041219475.png" alt=""></p>
<p>如果<code>-path &lt;pwd&gt;</code>中的<code>&lt;pwd&gt;</code>是文件路径，或仅使用<code>&lt;pwd&gt;</code>参数，则直接加密目录文件：</p>
<p><img src="/blackmatter_images/4241043227508.png" alt=""></p>
<h3 id="63-安全模式">6.3. 安全模式<a href="#63-安全模式" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>当使用<code>-safe</code>参数时，<code>BlackMatter</code>会首先检测是否是<code>RID</code>是否属于<code>BUILTIN\Administrators</code>，如果是，则进行以下操作。</p>
<p><img src="/blackmatter_images/3313706126733.png" alt=""></p>
<h4 id="631-创建自登录账户">6.3.1. 创建自登录账户<a href="#631-创建自登录账户" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>随机生成一个12位的密码：由3个随机大写字母、1个随机字符（<code>#</code>或<code>&amp;</code>）、3个随机数字、1个随机字符（<code>#</code>或<code>&amp;</code>）、4个随机小写字母组成。然后使用<code>NetUserSetInfo</code>创建<code>administrator</code>，密码则是刚才生成的12位字符串。</p>
<p><img src="/blackmatter_images/4580448107343.png" alt=""></p>
<p>然后创建注册表：<code>SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon</code>，设置以下键值：</p>
<pre tabindex="0"><code>AutoAdminLogon:1
DefaultUserName:Administrator
DefaultDomainName:[GetComputerNameW()]
DefaultPassword:[Random_Password()]
</code></pre><p>整体结构如下：</p>
<p><img src="/blackmatter_images/4860455127509.png" alt=""></p>
<h4 id="632-runonce自启动">6.3.2. RunOnce自启动<a href="#632-runonce自启动" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>为了实现持久化，<code>BlackMatter</code>会随机生成一个9位数值名称：由3个随机大写字母、3个随机数字和3个随机小写字母组成，数值内容为当前路径，写入到注册表：<code>SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce</code>中。</p>
<p><img src="/blackmatter_images/2350758120178.png" alt=""></p>
<h4 id="633-设置生成桌面壁纸">6.3.3. 设置生成桌面壁纸<a href="#633-设置生成桌面壁纸" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>根据当前屏幕大小，修改注册表项中的<code>hScreen</code>和<code>wScreen</code>：</p>
<p><img src="/blackmatter_images/233209122487.png" alt=""></p>
<p>当操作系统是<code>windows 10</code>时，会在注册表<code>SOFTWARE\\Policies\\Microsoft\\Windows\\OOBE</code>中设置<code>DisablePrivacyExperience:1</code>：</p>
<p><img src="/blackmatter_images/524210140367.png" alt=""></p>
<p><!-- raw HTML omitted -->壁纸生成的具体细节如下：<!-- raw HTML omitted --></p>
<p>创建<code>Times New Roman</code>字体的句柄，从内存中获取壁纸突显的字符串：</p>
<pre tabindex="0"><code>BlackMatter Ransomware encrypted all your files!
To get your data back and keep your privacy safe,
you must find [readme.txt] file
and follow the instructions!
</code></pre><p><img src="/blackmatter_images/3314512137971.png" alt=""></p>
<p>然后以二进制形式将图片写入到<code>C:\ProgramData\[id].bmp</code>，从而生成壁纸文件：</p>
<p><img src="/blackmatter_images/3919418135473.png" alt=""></p>
<p>修改注册表<code>HKEY_CURRENT_USER\Control Panel\Desktop</code>的键值，设置桌面壁纸：</p>
<pre tabindex="0"><code>WallPaper:C:\ProgramData\[id].bmp
WallpaperStyle:10
</code></pre><p><img src="/blackmatter_images/992920116714.png" alt=""></p>
<h4 id="634-重启进入安全模式">6.3.4. 重启进入安全模式<a href="#634-重启进入安全模式" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p><code>BlackMatter</code>会根据当前运行的操作系统版本，选择相应的命令使用<code>WinExec</code>执行，并重启操作系统。
当传递的参数为<code>True</code>时（从上方可以得知，当前模式传递的是<code>True</code>），启用安全模式：</p>
<pre tabindex="0"><code>winsows vista 之前的操作系统：bcdedit /set {{current}} safeboot network
winsows vista 之后的操作系统：bootcfg /raw /a /safeboot:network /id 1
</code></pre><p>当传递的参数为<code>False</code>时，该函数还提供了关闭功能：</p>
<pre tabindex="0"><code>winsows vista 之前的操作系统：bcdedit /deletevalue {{current}} safeboot
winsows vista 之后的操作系统：bootcfg /raw /fastdetect /id 1
</code></pre><p><img src="/blackmatter_images/1700123139154.png" alt=""></p>
<h3 id="64-壁纸模式">6.4. 壁纸模式<a href="#64-壁纸模式" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>当使用<code>-wall</code>参数时，<code>BlackMatter</code>仅生成壁纸，具体可参考<a href="#wallpaper">壁纸生成的具体细节</a>。</p>
<h3 id="65-默认模式">6.5. 默认模式<a href="#65-默认模式" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>当什么都不添加时，就进入到该模式，该模式涵盖了大多数的功能。</p>
<p><img src="/blackmatter_images/3815139134290.png" alt=""></p>
<h4 id="651-互斥锁">6.5.1. 互斥锁<a href="#651-互斥锁" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>当<code>Mutex_Flag</code>为真时，将运行一次互斥。首先是获取<code>MachineGuid</code>，再通过<code>MD4</code>加密生成<code>hash</code>，再使用<code>OpenMutexW</code>结果来测试是否已存在。</p>
<p><img src="/blackmatter_images/3512845127836.png" alt=""></p>
<p>如果存在，则关闭并退出，如果不存在则创建并继续：</p>
<p><img src="/blackmatter_images/4118951120970.png" alt=""></p>
<h4 id="652-网络请求">6.5.2. 网络请求<a href="#652-网络请求" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>如果配置文件中的<code>Post_Flag</code>为真，则会收集数据并发送到<code>C2</code>服务器。</p>
<p>在加密前会进行一次基本信息的收集，数据结构的<code>json</code>格式如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;bot_version&#34;</span><span class="p">:</span><span class="s2">&#34;%s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;bot_id&#34;</span><span class="p">:</span><span class="s2">&#34;%s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;bot_company&#34;</span><span class="p">:</span><span class="s2">&#34;%.8x%.8x%.8x%.8x%&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;host_hostname&#34;</span><span class="p">:</span><span class="s2">&#34;%s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;host_user&#34;</span><span class="p">:</span><span class="s2">&#34;%s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;host_os&#34;</span><span class="p">:</span><span class="s2">&#34;%s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;host_domain&#34;</span><span class="p">:</span><span class="s2">&#34;%s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;host_arch&#34;</span><span class="p">:</span><span class="s2">&#34;%s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;host_lang&#34;</span><span class="p">:</span><span class="s2">&#34;%s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;disks_info&#34;</span><span class="p">:[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>						<span class="c1">//当存在多个磁盘，该字典将变多
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>         <span class="nt">&#34;disk_name&#34;</span><span class="p">:</span><span class="s2">&#34;%s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;disk_size&#34;</span><span class="p">:</span><span class="s2">&#34;%u&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;free_size&#34;</span><span class="p">:</span><span class="s2">&#34;%u&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>以下是我在虚拟机中获取的加密前发送数据：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;bot_version&#34;</span><span class="p">:</span><span class="s2">&#34;1.2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;bot_id&#34;</span><span class="p">:</span><span class="s2">&#34;26a3ebea3de1f2c535eb81c5456fc830&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;bot_company&#34;</span><span class="p">:</span><span class="s2">&#34;512478c08dada2af19e49808fbda5b0b&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;host_hostname&#34;</span><span class="p">:</span><span class="s2">&#34;WIN-B1ESUN1R9U8&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;host_user&#34;</span><span class="p">:</span><span class="s2">&#34;alee&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;host_os&#34;</span><span class="p">:</span><span class="s2">&#34;Windows 7 Ultimate&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;host_domain&#34;</span><span class="p">:</span><span class="s2">&#34;WORKGROUP&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;host_arch&#34;</span><span class="p">:</span><span class="s2">&#34;x64&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;host_lang&#34;</span><span class="p">:</span><span class="s2">&#34;zh-CN&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;disks_info&#34;</span><span class="p">:[</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nt">&#34;disk_name&#34;</span><span class="p">:</span><span class="s2">&#34;C&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nt">&#34;disk_size&#34;</span><span class="p">:</span><span class="s2">&#34;102397&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nt">&#34;free_size&#34;</span><span class="p">:</span><span class="s2">&#34;70005&#34;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>当加密完成以后，还会进行一次结果统计，数据结构的<code>json</code>格式如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;bot_version&#34;</span><span class="p">:</span><span class="s2">&#34;%s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;bot_id&#34;</span><span class="p">:</span><span class="s2">&#34;%s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;bot_company&#34;</span><span class="p">:</span><span class="s2">&#34;%.8x%.8x%.8x%.8x%&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;stat_all_files&#34;</span><span class="p">:</span><span class="s2">&#34;%u&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;stat_not_encrypted&#34;</span><span class="p">:</span><span class="s2">&#34;%u&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;stat_size&#34;</span><span class="p">:</span><span class="s2">&#34;%s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;execution_time&#34;</span><span class="p">:</span><span class="s2">&#34;%u&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;start_time&#34;</span><span class="p">:</span><span class="s2">&#34;%u&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;stop_time&#34;</span><span class="p">:</span><span class="s2">&#34;%u&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>以下是我在虚拟机中获取的加密后发送数据</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;bot_version&#34;</span><span class="p">:</span><span class="s2">&#34;1.2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;bot_id&#34;</span><span class="p">:</span><span class="s2">&#34;26a3ebea3de1f2c535eb81c5456fc830&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;bot_company&#34;</span><span class="p">:</span><span class="s2">&#34;512478c08dada2af19e49808fbda5b0b&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;stat_all_files&#34;</span><span class="p">:</span><span class="s2">&#34;16499&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;stat_not_encrypted&#34;</span><span class="p">:</span><span class="s2">&#34;3&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;stat_size&#34;</span><span class="p">:</span><span class="s2">&#34;1282&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;execution_time&#34;</span><span class="p">:</span><span class="s2">&#34;829&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;start_time&#34;</span><span class="p">:</span><span class="s2">&#34;1633799826&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;stop_time&#34;</span><span class="p">:</span><span class="s2">&#34;1633800656&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>获取到数据后，会通过<code>AES</code>加密，再通过<code>base64</code>编码：</p>
<p><img src="/blackmatter_images/4454242190921.png" alt=""></p>
<p><code>AES</code>加密的密钥为：<code>A6F330B09CD47B4FB9214F7836AA46AD</code></p>
<p><img src="/blackmatter_images/2348558197308.png" alt=""></p>
<p>最终的<code>C2</code>服务器为：<code>https[:]//paymenthacks.com</code></p>
<p><img src="/blackmatter_images/4878954196676.png" alt=""></p>
<h4 id="653-清除回收站数据">6.5.3. 清除回收站数据<a href="#653-清除回收站数据" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>在加密前，会遍历每一个磁盘驱动器上的第一个<code>recycle</code>文件：</p>
<p><img src="/blackmatter_images/5382300124004.png" alt=""></p>
<p>然后删除所有<code>S-</code>开头的文件：</p>
<p><img src="/blackmatter_images/4865402132951.png" alt=""></p>
<h4 id="654-删除卷影副本">6.5.4. 删除卷影副本<a href="#654-删除卷影副本" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>使用<code>CoCreateInstance</code>创建两个对象，然后使用<code>IWbemServices::ExecQuery</code>方法执行<code>WQL</code>查询<code>SELECT * FROM Win32_ShadowCopy</code>检索卷影副本对象：</p>
<p><img src="/blackmatter_images/5327813125836.png" alt=""></p>
<p>调用<code>IEnumWbemClassObject::Next</code>枚举系统上的所有卷影副本，调用<code>IEnumWbemClassObject::Get</code>获取每个卷影副本的 ID，并调用<code>IWbemServices::DeleteInstance</code>删除它们。</p>
<h4 id="655-终止服务">6.5.5. 终止服务<a href="#655-终止服务" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>当<code>Kill_Service_Flag</code>为<code>True</code>时，使用<code>OpenSCManagerW</code>获取服务控制管理器句柄，然后使用<code>EnumServicesStatusExW</code>枚举所有服务，对比是否在终止名单中，如果是，则使用<code>ControlService</code>发送控制代码，使用<code>DeleteService</code>删除服务，服务列表如下：</p>
<pre tabindex="0"><code>&#34;mepocs&#34;、&#34;memtas&#34;、&#34;veeam&#34;、&#34;svc$&#34;、&#34;backup&#34;、&#34;sql&#34;、&#34;vss&#34;
</code></pre><p><img src="/blackmatter_images/3309612136445.png" alt=""></p>
<h4 id="656-杀死进程">6.5.6. 杀死进程<a href="#656-杀死进程" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>当<code>Kill_Process_Flag</code>为<code>True</code>时，使用<code>NtQuerySystemInformation</code>检索进程列表，对比是否在杀死名单中，如果是，使用<code>NtOpenProcess</code>确认句柄，使用<code>NtTerminateProcess</code>杀死进程，进程列表如下：</p>
<pre tabindex="0"><code>&#34;encsvc&#34;、&#34;thebat&#34;、&#34;mydesktopqos&#34;、&#34;xfssvccon&#34;、&#34;firefox&#34;、&#34;infopath&#34;、&#34;winword&#34;、&#34;steam&#34;、&#34;synctime&#34;、&#34;notepad&#34;、&#34;ocomm&#34;、&#34;onenote&#34;、&#34;mspub&#34;、&#34;thunderbird&#34;、&#34;agntsvc&#34;、&#34;sql&#34;、&#34;excel&#34;、&#34;powerpnt&#34;、&#34;outlook&#34;、&#34;wordpad&#34;、&#34;dbeng50&#34;、&#34;isqlplussvc&#34;、&#34;sqbcoreservice&#34;、&#34;oracle&#34;、&#34;ocautoupds&#34;、&#34;dbsnmp&#34;、&#34;msaccess&#34;、&#34;tbirdconfig&#34;、&#34;ocssd&#34;、&#34;mydesktopservice&#34;、&#34;visio&#34;
</code></pre><p><img src="/blackmatter_images/5616521163400.png" alt=""></p>
<h4 id="657-io多线程加密">6.5.7. I/O多线程加密<a href="#657-io多线程加密" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>创建用于处理<code>I/O</code>数据包的子线程，这些子线程使用<code>GetQueuedCompletionStatus</code>与<code>PostQueuedCompletionStatus</code>与主线程进行通信。接收到的数据包，都是需要处理的文件。</p>
<p><img src="/blackmatter_images/3954843145613.png" alt=""></p>
<p><strong>整个加密过程存在四个 case</strong></p>
<ol>
<li><code>case 0</code>：读取文件；</li>
</ol>
<p><img src="/blackmatter_images/1719746134911.png" alt=""></p>
<ol start="2">
<li><code>case 1</code>：加密和写入文件。加密采用了自定义的加密算法，待加密结束后，将文件重新写入磁盘；</li>
</ol>
<p><img src="/blackmatter_images/5614756143391.png" alt=""></p>
<p><img src="/blackmatter_images/3789249131162.png" alt=""></p>
<ol start="3">
<li><code>case 2</code>：写入文件页脚标识。当完成加密后，会在文件末端写入标识，标记该文件已被加密；</li>
</ol>
<p><img src="/blackmatter_images/485053131301.png" alt=""></p>
<ol start="4">
<li><code>case 3</code>：当加密完成并写入页脚后，调用<code>NtClose</code>关闭文件句柄，使用<code>RtlFreeHeap</code>释放缓冲区</li>
</ol>
<p><img src="/blackmatter_images/2986658148430.png" alt=""></p>
<h4 id="658-驱动器检索">6.5.8. 驱动器检索<a href="#658-驱动器检索" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>当<code>Drive_Flag</code>为<code>True</code>时，采用<code>FindFirstVolumeW</code>和<code>FindNextVolumeW</code>检索全部的卷，然后调用<code>GetVolumePathNamesForVolumeNameW</code>检索驱动器号和已安装文件夹路径的列表：</p>
<p><img src="/blackmatter_images/1439938191050.png" alt=""></p>
<p>当操作系统版本是<code>Windows 7</code>以前的版本时，将<code>bootmgr</code>挂载到最后一个驱动器后：</p>
<p><img src="/blackmatter_images/4987643209476.png" alt=""></p>
<h4 id="659-域内资源检索">6.5.9. 域内资源检索<a href="#659-域内资源检索" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>当<code>Network_Flag</code>为<code>True</code>时，将通过<code>DsGetDcNameW</code>获取域控制器信息，然后使用<code>DsGetDcOpenW</code>打开控制器，通过<code>DsGetDcNextW</code>枚举出所有的域控制器：</p>
<p><img src="/blackmatter_images/4952449217509.png" alt=""></p>
<p>然后采用<code>ADsEnumerateNext</code>来枚举域控制器内的<code>DNS</code>主机：</p>
<p><img src="/blackmatter_images/2959658206733.png" alt=""></p>
<p>然后使用<code>NetShareEnum</code>多线程寻找域内主机：</p>
<p><img src="/blackmatter_images/2985801230367.png" alt=""></p>
<p>剩下的就是目录过滤和加密了：</p>
<p><img src="/blackmatter_images/2315602227971.png" alt=""></p>
<h4 id="6510-检索文件并加密">6.5.10. 检索文件并加密<a href="#6510-检索文件并加密" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>当<code>Drive_Flag</code>为<code>True</code>时，使用<code>FindFirstVolumeW</code>和<code>FindNextVolumeW</code>获取所有卷的驱动器号和已安装文件夹路径的列表；扫描每个驱动器目录，在目录中放置赎金票据，并使用<code>FindFirstFileExW</code>和<code>FindNextFileW</code>枚举目录，避开所有名为<code>.</code>或<code>..</code>的文件或目录：</p>
<p><img src="/blackmatter_images/4150840180904.png" alt=""></p>
<p>在对文件进行加密时，首先会解除服务或进程对文件的占用：</p>
<p><img src="/blackmatter_images/5094041166456.png" alt=""></p>
<p>然后会检查文件是否已加密：</p>
<p><img src="/blackmatter_images/1359646182735.png" alt=""></p>
<p>将文件更名为带加密拓展名的文件：</p>
<p><img src="/blackmatter_images/3419454175780.png" alt=""></p>
<p>然后使用<code>CreateIoCompletionPort</code>向全局<code>I/O</code>注册文件句柄，让<code>I/O</code>子线程进行加密：</p>
<p><img src="/blackmatter_images/1081156172547.png" alt=""></p>
<p><strong>参考链接</strong></p>
<pre tabindex="0"><code>RID 说明：https://docs.microsoft.com/zh-tw/dotnet/api/system.security.principal.windowsprincipal.isinrole?redirectedfrom=MSDN&amp;view=windowsdesktop-5.0#overloads
OSMajorVersion 与 OSMinorVersion 对照表：https://docs.microsoft.com/en-us/windows-hardware/drivers/install/inf-manufacturer-section
样本配置文件提取器：https://github.com/advanced-threat-research/DarkSide-Config-Extract
</code></pre>
			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://www.a1ee.cn/tags/blackmatter">BlackMatter</a></span><span class="tag"><a href="https://www.a1ee.cn/tags/sample">Sample</a></span>
				</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg></p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2021-10-18 16:13 &#43;0800</p>
			</footer>
		</article>
		<div class="post-nav thin">
			<a class="next-post" href="https://www.a1ee.cn/medium/mountlocker/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;</span><br><span>MountLocker</span>
			</a>
			<a class="prev-post" href="https://www.a1ee.cn/medium/workminer/">
				<span class="post-nav-label">&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>WorkMiner</span>
			</a>
		</div>
		<div id="comments" class="thin">
</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2022 <a href="https://www.a1ee.cn">alee</a></p>
	</footer>



	<script src="https://www.a1ee.cn/js/bundle.min.8256b8724b9578bbdf6d6f04c894255bc760e78e8a2d60ec0a91ea993acd3b77.js" integrity="sha256-gla4ckuVeLvfbW8EyJQlW8dg546KLWDsCpHqmTrNO3c=" crossorigin="anonymous"></script>
	

</body>

</html>
