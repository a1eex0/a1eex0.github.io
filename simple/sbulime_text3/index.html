<!DOCTYPE html>
<html lang="zh-cn">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">
<meta itemprop="name" content="Sbulime_text3">
<meta itemprop="description" content="Sublime Text3 入门级爆破 下载Sublime Text3 x64(3211)，需要的工具是看雪论坛的x64dbg。 讨厌的地方有两个：首页 、弹窗。 针对首页上的字样，在"><meta itemprop="datePublished" content="2020-12-28T13:58:30+08:00" />
<meta itemprop="dateModified" content="2020-12-28T13:58:30+08:00" />
<meta itemprop="wordCount" content="2036"><meta itemprop="image" content="https://www.a1ee.cn/bg.png">
<meta itemprop="keywords" content="crack," /><meta property="og:title" content="Sbulime_text3" />
<meta property="og:description" content="Sublime Text3 入门级爆破 下载Sublime Text3 x64(3211)，需要的工具是看雪论坛的x64dbg。 讨厌的地方有两个：首页 、弹窗。 针对首页上的字样，在" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.a1ee.cn/simple/sbulime_text3/" /><meta property="og:image" content="https://www.a1ee.cn/bg.png" /><meta property="article:section" content="simple" />
<meta property="article:published_time" content="2020-12-28T13:58:30+08:00" />
<meta property="article:modified_time" content="2020-12-28T13:58:30+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.a1ee.cn/bg.png"/>

<meta name="twitter:title" content="Sbulime_text3"/>
<meta name="twitter:description" content="Sublime Text3 入门级爆破 下载Sublime Text3 x64(3211)，需要的工具是看雪论坛的x64dbg。 讨厌的地方有两个：首页 、弹窗。 针对首页上的字样，在"/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>Sbulime_text3</title>
	<link rel="stylesheet" href="https://www.a1ee.cn/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css" integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin="anonymous">
	<style>.bg-img {background-image: url('https://www.a1ee.cn/bg.png');}</style>
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://www.a1ee.cn">alee</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					
				<a href="https://www.a1ee.cn/basic/">BASIC</a>
				<a href="https://www.a1ee.cn/simple/">SIMPLE</a>
				<a href="https://www.a1ee.cn/medium/">MEDIUM</a>
				<a href="https://www.a1ee.cn/about-me/">ABOUT</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="img-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg></button><span class="hdr-social hide-in-mobile"><a href="https://github.com/a1eex0" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span><button id="menu-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://www.a1ee.cn/basic/">BASIC</a></li>
			<li><a href="https://www.a1ee.cn/simple/">SIMPLE</a></li>
			<li><a href="https://www.a1ee.cn/medium/">MEDIUM</a></li>
			<li><a href="https://www.a1ee.cn/about-me/">ABOUT</a></li>
		</ul>
	</div>


	<div class="bg-img"></div>
	<main class="site-main section-inner thin animated fadeIn faster">
		<h1>Sbulime_text3</h1>
		<div class="content">
			<h1 id="sublime-text3">Sublime Text3<a href="#sublime-text3" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<h2 id="入门级爆破">入门级爆破<a href="#入门级爆破" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>下载<a href="https://download.sublimetext.com/Sublime%20Text%20Build%203211%20x64%20Setup.exe">Sublime Text3 x64(3211)</a>，需要的工具是<a href="https://tools.pediy.com/win/Debuggers/x64dbg/x64dbg_v25.zip">看雪论坛的x64dbg</a>。</p>
<p>讨厌的地方有两个：首页 、弹窗。</p>
<p><img src="/sublime_images/20191224114347166_21263.png" alt="首页"></p>
<p><img src="/sublime_images/20191224114836044_14870.png" alt="弹窗"></p>
<p>针对首页上的字样，在符号中搜索 <code>setwindowtext</code></p>
<p><img src="/sublime_images/20191224115402732_5529.png" alt="去首页一"></p>
<p>跳转到函数位置下断点，重新载入程序，在栈区跳转到返回地址。</p>
<p><img src="/sublime_images/20191224150252635_30230.png" alt="定位setwindowtext函数"></p>
<p>现在跳转到了调用 <code>setwindowtext</code> 函数的代码地址，向上寻找函数块起始位置。</p>
<p><img src="/sublime_images/20191224150527213_7743.png" alt="调用函数"></p>
<p><img src="/sublime_images/20191226143637137_8505.png" alt="函数块起始处"></p>
<p>下断重载，逐条运行，发现关键点：</p>
<p><img src="/sublime_images/20191224171626205_30814.png" alt="关键点"></p>
<p>这里应该知道，是第三个条件跳转语句是什么关键跳转了，根据跳转目的地判断，第三个跳转是正常显示的点。
二进制修改如下：</p>
<pre tabindex="0"><code>000000013FCB3CC7   | 75 1E                 | jne sublime_text.13FCB3CE7         |
修改为：
000000013FCB3CC7   | EB 77                 | jmp sublime_text.13FCB3D40         |
</code></pre><p><img src="/sublime_images/20191224173133163_3088.png" alt="保存补丁"></p>
<p>去掉首页后，需要该弹窗，弹窗内容可以使用字符搜索来进行。</p>
<p><img src="/sublime_images/20191224173647162_18475.png" alt="搜索字符串"></p>
<p>搜索<code>hello</code></p>
<p><img src="/sublime_images/20191224174111513_15972.png" alt="关键字符串"></p>
<p>下断点，触发并执行过来</p>
<p><img src="/sublime_images/20191224174617929_31014.png" alt="关键位置"></p>
<p>触发了断点，说明位置是正确的，观察上下文</p>
<pre tabindex="0"><code>000000013F38098D   | 48:83EC 28            | sub rsp,28                         |
000000013F380991   | 48:8D15 B6D95C00      | lea rdx,qword ptr ds:[13F94E34E]   | 000000013F94E34E:&#34;Hello! Thanks for trying out Sublime Text.\n\nThis is an unregistered evaluation version, and although the trial is untimed, a license must be purchased for continued use.\n\nWould you like to purchase a license now?&#34;
000000013F380998   | 4C:8D05 B1DC5B00      | lea r8,qword ptr ds:[13F93E650]    | 000000013F93E650:&#34;This is an unregistered copy&#34;
000000013F38099F   | 4C:8D0D 91675C00      | lea r9,qword ptr ds:[13F947137]    | 000000013F947137:&#34;Purchase&#34;
000000013F3809A6   | 31C9                  | xor ecx,ecx                        |
000000013F3809A8   | E8 9F9E1000           | call sublime_text_s.13F48A84C      |
000000013F3809AD   | 84C0                  | test al,al                         |
000000013F3809AF   | 74 10                 | je sublime_text_s.13F3809C1        |
000000013F3809B1   | 48:8D0D 62D95B00      | lea rcx,qword ptr ds:[13F93E31A]   | 000000013F93E31A:&#34;https://www.sublimetext.com/buy&#34;
000000013F3809B8   | 48:83C4 28            | add rsp,28                         |
000000013F3809BC   | E9 AD581000           | jmp sublime_text_s.13F48626E       |
</code></pre><p>发现整段代码都是用来进行弹窗的，那么直接在代码起始地ret，就可以实现最小化修改了4</p>
<p><img src="/sublime_images/20191224175149768_9258.png" alt="最小化修改"></p>
<p>至此爆破就结束了。</p>
<h2 id="最小化特征码替换">最小化特征码替换<a href="#最小化特征码替换" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>版本：x64“Sublime Text Version 3.2.2 Buile 3211”</p>
<p><img src="/sublime_images/20191231155733014_5896.png" alt=""></p>
<p>特征码是：</p>
<pre tabindex="0"><code>66 83 25 F0 CF 6F 00 00
</code></pre><p>修改为：</p>
<pre tabindex="0"><code>C6 05 F1 CF 6F 00 01 90
</code></pre><h2 id="追码过程记录">追码过程记录<a href="#追码过程记录" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>如果针对特定功能点进行爆破的话，改动的地方会很多，打补丁的话也不太方便。所以为了实现最小化修改， 进行追码。随便寻找一个关键点进行追码，这里从 <code>title</code> 上的 <code>（unregistered）</code> 入手。</p>
<p>第一步：对 <code>setwindowtextw</code> 下断；</p>
<p><img src="/sublime_images/20191231161536694_8093.png" alt="第一步"></p>
<p>第二步：重载，找到关键跳转；</p>
<p><img src="/sublime_images/20191231162016189_2744.png" alt="第二步"></p>
<p>第三步：这里知道 <code>r15</code>寄存器的值是关键值，现在开始向上追码；</p>
<p><img src="/sublime_images/20191231162322382_10174.png" alt="第三步"></p>
<p>第四步：继续追码 <code>r9</code> ；</p>
<p><img src="/sublime_images/20191231194453001_6819.png" alt="第四步"></p>
<p>第五步：发现 <code>r13</code> 与 1 进行了异或运算；</p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">二进制数</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">A</td>
<td style="text-align:left">1010</td>
</tr>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">0001</td>
</tr>
<tr>
<td style="text-align:left">or A,1</td>
<td style="text-align:left">1011</td>
</tr>
<tr>
<td style="text-align:left">B</td>
<td style="text-align:left">1011</td>
</tr>
</tbody>
</table>
<p><img src="/sublime_images/20191231195132774_20902.png" alt="第五步"></p>
<p>第六步：找到关键内存地址；</p>
<p><img src="/sublime_images/20191231195445476_15990.png" alt="第六步"></p>
<p>第七步：现在知道了整个过程是如何影响最终走向的，接下来梳理一下算法过程：</p>
<pre tabindex="0"><code>
mov rax,qword ptr ds:[r15+4E8] ;关键内存地址赋值给rax
xor ebx,ebx                    ;将ebx制空
xor ecx,ecx                    ;将ecx制空
cmp byte ptr ds:[rax],bl       ;将rax地址中的值与0比较
sete cl                        ;rax地址中的值为0，则cl为1，否则cl为0
lea edx,qword ptr ds:[rcx+rcx] ;将rcx+rcx的值赋值给edx
cmp byte ptr ds:[rax+1],bl     ;对比[rax+1]的值是否为0，用来影响cmove赋值。
lea edi,qword ptr ds:[rcx+rcx+4];将edx+4赋值给edi
cmove edi,edx                  ;此时如果zf为1，则将edx的值赋给edi，否则跳过该条命令。
lea r13d,qword ptr ds:[rdi+8]  ;将rdi+8的值赋值给r13
or r13d,eax                    ;将r13与eax进行异或运算
mov r9d,r13d                   ;将r13的值赋值给r9
mov r15d,r9d                   ;将r9的值赋值给r15
test r15b,2                    ;r15的值是关键
jne sublime_text.13F8A3CE7
test r15b,4
jne sublime_text.13F8A3D30
test r15b,10
je sublime_text.13F8A3D40      ;here
</code></pre><p>从截取的代码来看，要进行到最后的跳转，需要满足以下条件：</p>
<pre tabindex="0"><code>r15 and 0010b = 1
r15 and 0100b = 1
r15 and 10000b = 1
</code></pre><p><strong>抛开最后 &lsquo;r13&rsquo; 与 &rsquo;eax&rsquo; 进行异或操作，观察 &lsquo;r13&rsquo; 的来源值为&rsquo; rdi+8&rsquo; ，&lsquo;rdi&rsquo; 等于 &rsquo;edx+4&rsquo; ，或者 &rsquo;edx&rsquo; ，&rsquo;edx&rsquo; 则等于 &lsquo;2h&rsquo; 或者 &lsquo;0h&rsquo; ，简单测试一下 &lsquo;[rax] = 1h&rsquo; ，则满足以下所有条件，且在异或操作时，&rsquo;eax&rsquo; 的值被赋值为了 &lsquo;0h&rsquo; ，对 &lsquo;r13&rsquo; 没有影响。</strong></p>
<p>第八步：给关键地址下硬件写入断点，来定位它最开始被修改的地址；</p>
<p><img src="/sublime_images/20191231220024707_2155.png" alt="第八步"></p>
<p>第九步：重载、运行；</p>
<p><img src="/sublime_images/20191231220255356_26508.png" alt="第九步"></p>
<p>第十步：修改汇编代码，并测试是否有效：
先在此处将关键地址修改为1，运行查看情况：</p>
<p><img src="/sublime_images/20191231220941087_2205.png" alt="仅修改"></p>
<p>按如下方式修改代码：</p>
<pre tabindex="0"><code>000000013F701FA8 | 66:8325 F0CF6F00 00     | and word ptr ds:[13FDFEFA0],0      | 将关键地址赋值为1h
修改为：
000000013F701FA8 | C605 F1CF6F00 01        | mov byte ptr ds:[13FDFEFA0],1      | 将关键地址赋值为1h
000000013F701FAF | 90                      | nop                                |
</code></pre><p><img src="/sublime_images/20191231221142150_18876.png" alt="修改代码"></p>
<p><strong>最后总结得出最小特征码</strong></p>
<pre tabindex="0"><code>66 83 25 F0 CF 6F 00 00
</code></pre><p><strong>修改为：</strong></p>
<pre tabindex="0"><code>C6 05 F1 CF 6F 00 01 90
</code></pre><p>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</p>
<h2 id="2020年3月28日更新制作补丁">2020年3月28日更新：制作补丁<a href="#2020年3月28日更新制作补丁" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</p>
<p>偶然间的到了一个补丁编写软件<a href="https://www.ghpym.com/dup2.html">（dup2）</a>，然后就试着用它来制作了一个patch补丁。另外修改一个隐藏的校验。
在以往的经验中，发现关于上显示的 <code>&quot;Unregistered&quot;</code> 上面的判断跳转是根据内存地址来的，搜索字符串 <code>&quot;Unregistered&quot;</code> ：</p>
<p><img src="/sublime_images/20200328085104078_25759.png" alt="字符串搜索"></p>
<p>找到上面的判断跳转：</p>
<p><img src="/sublime_images/20200328085425946_20527.png" alt="关键点"></p>
<p>结果显示如下：</p>
<p><img src="/sublime_images/20200328085543272_8871.png" alt="显示结果"></p>
<p>在刚才的rsi内存地址处，下一个硬件读取断点，重载程序：</p>
<p><img src="/sublime_images/20200328090915363_23736.png" alt="目标"></p>
<p>在硬件断点停留的位置，可以看到and运算将目标地址置零了，修改方式就很简单了：
原始代码：</p>
<pre tabindex="0"><code>00007FF681F31FA8 | 66:8325 F0CF6F00 00      | and word ptr ds:[7FF68262EFA0],0        | 第一个修改点
00007FF681F31FB0 | 8325 EDCF6F00 00         | and dword ptr ds:[7FF68262EFA4],0       |
</code></pre><p>修改方案一：</p>
<pre tabindex="0"><code>00007FF681F31FA8 | C605 F1CF6F00 01         | mov byte ptr ds:[7FF68262EFA0],1        | 第一个修改点
00007FF681F31FAF | 90                       | nop                                     |
00007FF681F31FB0 | 8325 EDCF6F00 00         | and dword ptr ds:[7FF68262EFA4],0       |
</code></pre><p>修改方案二：</p>
<pre tabindex="0"><code>00007FF681F31FA8 | 66:8325 F0CF6F00 00      | and word ptr ds:[7FF68262EFA0],0        | 第一个修改点
00007FF681F31FB0 | C605 E9CF6F00 01         | mov byte ptr ds:[7FF68262EFA0],1        |
</code></pre><p>方案一改的多，方案二改的少，因为<code>7FF68262EFA4</code>的值本来就是0，这里的置零是无意义代码，为了修改少我选择的是方案二进行修改。
删除当前硬件断点，在目标地址重新下一个硬件写入断点，运行程序，逐个点击功能点，尝试触发隐藏校验函数。
过了一段时间后，隐藏校验点触发，在尝试了不同的点击顺序后，貌似这是一个基于时间的校验点，</p>
<p><img src="/sublime_images/20200328101518044_13976.png" alt="隐藏"></p>
<pre tabindex="0"><code>00007FF70B29EB28 | C601 01                  | mov byte ptr ds:[rcx],1                 | 隐藏校验
00007FF70B29EB2B | C3                       | ret                                     |
</code></pre><p><img src="/sublime_images/20200328101722123_2883.png" alt="补丁"></p>
<p>这样爆破就算结束了。
制作补丁：</p>
<p><img src="/sublime_images/20200328102450486_21458.png" alt=""></p>
<p>将原始文件和破解后的文件进行偏移对比，得出要修改替换的字节，点击保存，在点击方案-创建补丁-就可以生成path文件。
<strong>注：在目标文件处加上绝对路径，就可以直接打开目标文件，未加路劲的话，默认为当前patch文件目录，未找到会提示用户自行选取。</strong></p>

		</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2022 <a href="https://www.a1ee.cn">alee</a></p>
	</footer>



	<script src="https://www.a1ee.cn/js/bundle.min.8256b8724b9578bbdf6d6f04c894255bc760e78e8a2d60ec0a91ea993acd3b77.js" integrity="sha256-gla4ckuVeLvfbW8EyJQlW8dg546KLWDsCpHqmTrNO3c=" crossorigin="anonymous"></script>
	

</body>

</html>
